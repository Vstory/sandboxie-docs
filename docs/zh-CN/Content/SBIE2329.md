# SBIE2329

**消息** SBIE2329 无法找到 FFS 序列 %2

**严重性**：错误（弹窗）

## 描述

当沙盘的 DLL 钩子安装程序尝试为某个函数寻找 `快速前进序列（FFS）` 的目标，但未能识别期望的指令模式时，会触发此条消息。沙盘通过检测 `FFS`，来跟踪小型跳板存根（常见于浏览器或其他应用程序），定位到真实/本机目标并在其上安装钩子。如果无法找到或解析该序列，则记录 `SBIE2329`，钩子安装程序可能会采用其他策略或报告失败。

该消息会包含未能找到 `FFS` 序列的函数名称。

## 常见原因

- 目标二进制文件已更改（新的浏览器或应用程序版本），导致启发式模式不再匹配
- 函数前序由不同的工具链、编译选项编译或优化，因此不存在 `FFS` 模式
- 代码被混淆、加壳，或被一个不包含期望 `FFS` 表或指针的小存根替换
- 架构/兼容性差异（x86、x64、ARM），现有启发式方法未能覆盖已观察到的模式

## 建议操作

1. 更新至最新的沙盘版本 —— 钩子启发式会定期更新，以适配新的浏览器或应用程序布局[^1]
2. 使用同一程序的不同构建或厂商版本进行测试（例如不同的 Chromium 构建、不同的 Firefox 构建），以确认问题是否只影响某特定版本[^2]
3. 如果该函数的钩子并非必须，可通过跳过该函数或模块的钩子（使用函数级或模块级跳过设定，或 DLL 提供的跟踪/钩子跳过配置）禁用相应启发式。这样可避免对命名函数进行 `FFS` 解析尝试[^3]
4. 收集诊断信息反馈给维护者：进程镜像名称、模块名称及基址、弹窗显示的函数名称、操作系统版本、以及函数前序的小型内存转储或反汇编，以便维护者更新启发式[^4]

## 相关消息

- [SBIE2303](SBIE2303.md) —— 用于各种钩子失败的泛用钩子错误
- [SBIE2328](SBIE2328.md) —— 无法解析 Chrome 沙箱钩子（用于 Chrome/Firefox 跳板启发式）

## 实现说明及脚注

以下说明供维护者和高级用户追踪 SBIE2329 的产生过程。无行号。

[^1]: `FFS` 检测与解析工具实现于 `common/hook_util.c`（如`Hook_GetFFSTarget`、`Hook_GetFFSTargetOld`、`Hook_GetFFSTargetNew` 等函数）。这些函数内含架构感知的启发式，可以识别 `FFS` 前序并解析其真实/本机目标地址

[^2]: DLL 钩子安装程序（`core/dll/dllhook.c`）在尝试安装钩子时会调用 `Hook_GetFFSTarget()`。若未找到 `FFS` 目标，则钩子路径通过调用日志 API 记录 `SBIE2329`（代码调用 `SbieApi_Log(2329, ...)`），并记录钩子统计信息表明缺乏 `FFS` 目标

[^3]: `Hook_GetFFSTarget()` 也被其他依赖同样解析逻辑的路径复用（例如 `core/low/inject.c` 与 `core/dll/gui.c` 的注入及跟踪代码），因此同一启发式无法解析跳板时，多个子系统都可能出现失败

[^4]: 提交 Bug 报告时，请包含弹窗显示的函数名称与模块镜像（或提取的函数前序/反汇编片段）。这些信息通常足够维护者复现实例并完善启发式