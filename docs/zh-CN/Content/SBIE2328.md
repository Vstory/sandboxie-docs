# SBIE2328

**信息** SBIE2328 无法解析 Chrome 沙箱钩子 %2

**严重性**：错误（弹窗）

> [!Note]
> 在部分版本中，钩子安装程序已禁用显式的 `SBIE2328` 弹窗。此时，未解析的钩子会记录在钩子监控器 / 跟踪输出中（监控信息会包含 "Chrome Hook Unresolved"），以及钩子统计数据，而不会显示用户级弹窗。如果没有看到弹窗，请检查监控器/跟踪输出，在沙盘管理器的资源/监控窗口查看，或启用 API/钩子跟踪以收集诊断细节。[^1][^2]

## 描述

该信息表明，沙盘的 DLL 钩子代码尝试检测或跟踪某浏览器（基于 Chromium/Chrome 或 Firefox）运行时钩子，但无法解析目标地址。信息会包含尝试解析的函数名称。

沙盘内置启发式逻辑，可以识别部分浏览器在进程内安装钩子的方式（即一个小跳板跳转到函数指针表）。当检测到该模式后，沙盘会尝试定位真实的目标函数并对其进行钩子，而不是仅钩住小跳板。如果解析失败，则会触发 `SBIE2328`。[ ^1 ]

## 常见原因

- 浏览器或目标模块更改了内部代码布局（新版本），导致启发式逻辑无法找到预期的指令模式。[ ^1 ]
- 目标模块被打包、混淆，或使用不同的编译工具链，阻碍了识别预期模式。
- 检测到的跳板指向了不可访问的数据或代码，或格式与预期不符（例如调用约定不同或数据被重定位）。
- 平台 / 架构差异（x86、x64 或 ARM），导致现有启发式检测逻辑无法覆盖当前模式。[ ^3 ]

## 建议操作

1. 更新沙盘到最新版本。钩子的启发式逻辑会根据浏览器变更进行更新。[ ^3 ]
2. 如果该问题仅在特定浏览器版本或厂商（Chrome、Vivaldi、部分 Firefox 版本）出现，请尝试其他浏览器版本，或针对该模块禁用沙盘钩子跟踪。
3. 如需临时规避失败，可通过 `FuncSkipHook` 或 `SkipHook` 配置，让钩子系统跳过相应进程或函数（见高级配置），以防沙盘对该函数进行 Chrome 特定解析。
4. 收集诊断信息（模块名称、函数名称、进程镜像），向沙盘维护者反馈，以便调整启发式逻辑或为新浏览器布局添加显式支持。

## 相关信息和设置

- [SBIE2303](SBIE2303.md) — 通用钩子错误，适用于多种钩子失败场景
- [SBIE2329](SBIE2329.md) — 未找到快速转发序列（FFS）目标或其他钩子解析相关问题
- [FuncSkipHook](FuncSkipHook.md) — 函数级设置：指定沙盘不尝试钩子的 API 函数名称列表。匹配到该列表的函数时，钩子安装器会跳过钩子流程
- [SkipHook](SkipHook.md) — 模块 / 钩子名称级设置：逗号分隔指定模块或镜像名称与钩子标识符，用于跳过某些模块的钩子。调用方会检查 `Dll_SkipHook` 并阻止对应模块安装钩子（注意：并非所有钩子安装路径都必然查询该设置）

## 实现说明与脚注

以下技术细节面向维护者和希望溯源信息的高级用户，具体代码行号已略去。

[^1]: 钩子解析逻辑由 `common/hook_util.c` 中的 `Hook_CheckChromeHook(...)` 实现。该代码会扫描可疑跳板的机器指令，并试图定位表或真实目标指针（针对 x86、x64 和 ARM 有不同分支）。如模式匹配未找到可用目标，则返回特殊失败值用于指示未解析状态。

[^2]: 在 `core/dll/dllhook.c` 中，沙盘的钩子安装器会调用 `Hook_CheckChromeHook(...)`。如助手函数返回特殊失败值，代码会将钩子标记为 `CHROME_FAIL` 状态，并可能发出 `SBIE2328`（该信息的触发路径就在 Chrome 钩子解析逻辑旁边）。钩子代码还会记录钩子统计信息（`HOOK_STAT_CHROME_FAIL`），以便诊断。

[^3]: 启发式逻辑兼容多种浏览器（Chrome、Chromium 派生浏览器，以及部分 Firefox/启动器版本）与多种架构；当浏览器更换编译工具链或内部布局后，需更新检测逻辑。提供模块镜像和函数名称有助于维护者复现问题及完善检测代码